<script>
async function registrar() {
    const u = document.getElementById('user').value;
    const e = document.getElementById('email').value;
    const p1 = document.getElementById('pass1').value;
    const p2 = document.getElementById('pass2').value;

    // 1. Validación básica
    if(!u || !e || !p1) return alert("Agatha: Faltan datos obligatorios.");
    if(p1 !== p2) return alert("Agatha: Las claves no coinciden.");

    try {
        // 2. Intento de conexión al API
        const res = await fetch('/api/auth', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }, // Es importante avisar que enviamos JSON
            body: JSON.stringify({ 
                username: u, 
                email: e, 
                password: p1, 
                action: 'register' 
            })
        });

        const data = await res.json();

        if(res.ok) {
            alert("Agatha: ¡Sincronización Exitosa! Bienvenido.");
            window.location.href = "login.html";
        } else {
            // 3. Si el servidor responde pero con error (ej: 500 o 400)
            alert("Agatha dice: " + (data.error || "Error desconocido en el nodo."));
        }
    } catch (err) {
        // 4. Si ni siquiera pudo llegar al servidor (ej: error de red o 404)
        alert("Fallo crítico: No se pudo contactar con el núcleo Agatha. Verifica la ruta /api/auth");
        console.error("Error de red:", err);
    }
}
</script>
