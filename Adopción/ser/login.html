<script>
async function entrar() {
    const u = document.getElementById('user').value;
    const p = document.getElementById('pass').value;

    if(!u || !p) return alert("Agatha: Ingresa tus credenciales.");

    try {
        const res = await fetch('/api/auth', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                username: u, 
                password: p, 
                action: 'login' 
            })
        });

        // Intentamos leer la respuesta del servidor
        const data = await res.json();

        if(res.ok) {
            alert("Acceso concedido. Agatha te reconoce.");
            // Guardamos el nombre para que la web lo recuerde (opcional)
            sessionStorage.setItem('usuario', u);
            window.location.href = "index.html";
        } else {
            // Si el login falla, Agatha nos dirá por qué
            alert("Agatha: " + (data.error || "Identidad no confirmada."));
        }
    } catch (err) {
        // Aquí es donde atrapamos la "X roja" o fallos de red
        alert("Fallo de conexión: El núcleo no responde. Revisa si el archivo auth.js está en /functions/api/");
        console.error("Error en el fetch:", err);
    }
}
</script>
